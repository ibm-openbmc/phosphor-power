{
  "comments": [ "phosphor-regulators configuration file for IBM Rainier systems" ],


  "rules": [
    {
      "comments": [ "Rule to set PMBus PAGE to 0" ],
      "id": "set_page0_rule",
      "actions": [
        { "i2c_write_byte": { "register": "0x00", "value": "0x00" } }
      ]
    },


    {
      "comments": [ "Rule to set PMBus PAGE to 1" ],
      "id": "set_page1_rule",
      "actions": [
        { "i2c_write_byte": { "register": "0x00", "value": "0x01" } }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of a PMBus regulator" ],
      "id": "set_voltage_rule",
      "actions": [
        {
          "comments": [ "Write volts value to VOUT_COMMAND in linear format.",
                        "Get volts value from configuration.  Get exponent",
                        "from VOUT_MODE.  Verify write was successful." ],
          "pmbus_write_vout_command": { "format": "linear", "is_verified": true }
        }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of PAGE 0 of a PMBus regulator" ],
      "id": "set_voltage_page0_rule",
      "actions": [
        { "run_rule": "set_page0_rule" },
        { "run_rule": "set_voltage_rule" }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of PAGE 1 of a PMBus regulator" ],
      "id": "set_voltage_page1_rule",
      "actions": [
        { "run_rule": "set_page1_rule" },
        { "run_rule": "set_voltage_rule" }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of a PMBus regulator using",
                    "PMBus OPERATION and VOUT_COMMAND" ],
      "id": "set_operation_and_voltage_rule",
      "actions": [
        {
          "comments": [ "Set PMBus OPERATION to 0x80 indicating output voltage",
                        "is set by the PMBus VOUT_COMMAND" ],
          "i2c_write_byte": { "register": "0x01", "value": "0x80" }
        },

        {
          "comments": [ "Set the output voltage using the PMBus VOUT_COMMAND" ],
          "run_rule": "set_voltage_rule"
        },

        {
          "comments": [ "Set PMBus OPERATION to 0xB0 indicating output voltage",
                        "will now be set by AVSBus (AVS_VOUT_COMMAND).",
                        "Hardware settings cause the VOUT_COMMAND value to be",
                        "the initial voltage value for AVSBus." ],
          "i2c_write_byte": { "register": "0x01", "value": "0xB0" }
        }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of PAGE 0 of a PMBus regulator",
                    "using PMBus OPERATION and VOUT_COMMAND" ],
      "id": "set_operation_and_voltage_page0_rule",
      "actions": [
        { "run_rule": "set_page0_rule" },
        { "run_rule": "set_operation_and_voltage_rule" }
      ]
    },


    {
      "comments": [ "Rule to set output voltage of PAGE 1 of a PMBus regulator",
                    "using PMBus OPERATION and VOUT_COMMAND" ],
      "id": "set_operation_and_voltage_page1_rule",
      "actions": [
        { "run_rule": "set_page1_rule" },
        { "run_rule": "set_operation_and_voltage_rule" }
      ]
    },


    {
      "comments": [ "Rule to set IOUT_OC_WARN_LIMIT for a PMBus regulator" ],
      "id": "set_iout_oc_warn_limit_rule",
      "actions": [
        {
          "comments": [ "Set PMBus IOUT_OC_WARN_LIMIT to 326A to ensure OCW",
                        "asserts at the roll-over bug identified in the",
                        "Pearson/Saddleback silicon.  326A = 0x08A3.  PMBus",
                        "requires the low order byte to be written first." ],
          "i2c_write_bytes": { "register": "0x4A", "values": [ "0xA3", "0x08" ] }
        }
      ]
    },


    {
      "comments": [ "Rule to configure a VDD rail using the PMBus interface" ],
      "id": "configure_vdd_rule",
      "actions": [
        { "run_rule": "set_page0_rule" },
        { "run_rule": "set_iout_oc_warn_limit_rule" },
        { "run_rule": "set_operation_and_voltage_rule" }
      ]
    },


    {
      "comments": [ "Rule to set the AVSBus activity timeout on IR35221",
                    "regulators.  Uses the secondary I2C interface." ],
      "id": "set_avsbus_timeout_ir35221_rule",
      "actions": [
        {
          "comments": [ "Set config page to 0" ],
          "i2c_write_byte": { "register": "0xFF", "value": "0x00" }
        },

        {
          "comments": [ "Set AVSBus activity timeout to 1us" ],
          "i2c_write_byte": { "register": "0x2F", "value": "0x06" }
        }
      ]
    },


    {
      "comments": [ "Rule to set the AVSBus activity timeout on XDPE132G5C",
                    "regulators.  Uses the secondary I2C interface." ],
      "id": "set_avsbus_timeout_xdpe132g5c_rule",
      "actions": [
        {
          "comments": [ "Set config page to 0" ],
          "i2c_write_byte": { "register": "0xFF", "value": "0x00" }
        },

        {
          "comments": [ "Set AVSBus activity timeout to 1us" ],
          "i2c_write_byte": { "register": "0x36", "value": "0x06" }
        }
      ]
    }
  ],


  "chassis": [
    {
      "comments": [ "Chassis (drawer) 1" ],
      "number": 1,
      "devices": [
        {
          "comments": [ "AVDD / TPS546C20",
                        "In schematic: bus 4 (1-based), address 0x24 (8-bit)",
                        "Does not have power at standby; cannot be configured",
                        "Does not support the PMBus PAGE command" ],
          "id": "avdd_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 3, "address": "0x12" },
          "rails": [
            {
              "id": "avdd_rail"
            }
          ]
        },


        {
          "comments": [ "3.3VA / TPS549D22",
                        "In schematic: bus 9 (1-based), address 0x36 (8-bit)",
                        "Does not have power at standby; cannot be configured",
                        "Does not support the PMBus PAGE command" ],
          "id": "3_3va_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 8, "address": "0x1B" },
          "rails": [
            {
              "id": "3_3va_rail"
            }
          ]
        },


        {
          "comments": [ "3.3VB / TPS549D22",
                        "In schematic: bus 4 (1-based), address 0x38 (8-bit)",
                        "Does not have power at standby; cannot be configured",
                        "Does not support the PMBus PAGE command" ],
          "id": "3_3vb_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 3, "address": "0x1C" },
          "rails": [
            {
              "id": "3_3vb_rail"
            }
          ]
        },


        {
          "comments": [ "VDDp0 DCM 0 / XDPE132G5C: Primary PMBus Interface",
                        "In schematic: bus 10 (1-based), address 0xE0 (8-bit)" ],
          "id": "vdd_p0_dcm0_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector0/vdd-vrm",
          "i2c_interface": { "bus": 9, "address": "0x70" },
          "rails": [
            {
              "id": "vdd_p0_dcm0_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "configure_vdd_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDDp0 DCM 0 / XDPE132G5C: Secondary I2C Interface",
                        "In schematic: bus 10 (1-based), address 0x80 (8-bit)" ],
          "id": "vdd_p0_dcm0_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector0/vdd-vrm",
          "i2c_interface": { "bus": 9, "address": "0x40" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_xdpe132g5c_rule"
          }
        },


        {
          "comments": [ "VDDp1 DCM 0 / XDPE132G5C: Primary PMBus Interface",
                        "In schematic: bus 10 (1-based), address 0xE2 (8-bit)" ],
          "id": "vdd_p1_dcm0_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector0/vdd-vrm",
          "i2c_interface": { "bus": 9, "address": "0x71" },
          "rails": [
            {
              "id": "vdd_p1_dcm0_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "configure_vdd_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDDp1 DCM 0 / XDPE132G5C: Secondary I2C Interface",
                        "In schematic: bus 10 (1-based), address 0x82 (8-bit)" ],
          "id": "vdd_p1_dcm0_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector0/vdd-vrm",
          "i2c_interface": { "bus": 9, "address": "0x41" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_xdpe132g5c_rule"
          }
        },


        {
          "comments": [ "VDDp0 DCM 1 / XDPE132G5C: Primary PMBus Interface",
                        "In schematic: bus 11 (1-based), address 0xE0 (8-bit)" ],
          "id": "vdd_p0_dcm1_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector1/vdd-vrm",
          "i2c_interface": { "bus": 10, "address": "0x70" },
          "rails": [
            {
              "id": "vdd_p0_dcm1_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "configure_vdd_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDDp0 DCM 1 / XDPE132G5C: Secondary I2C Interface",
                        "In schematic: bus 11 (1-based), address 0x80 (8-bit)" ],
          "id": "vdd_p0_dcm1_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector1/vdd-vrm",
          "i2c_interface": { "bus": 10, "address": "0x40" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_xdpe132g5c_rule"
          }
        },


        {
          "comments": [ "VDDp1 DCM 1 / XDPE132G5C: Primary PMBus Interface",
                        "In schematic: bus 11 (1-based), address 0xE2 (8-bit)" ],
          "id": "vdd_p1_dcm1_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector1/vdd-vrm",
          "i2c_interface": { "bus": 10, "address": "0x71" },
          "rails": [
            {
              "id": "vdd_p1_dcm1_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "configure_vdd_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDDp1 DCM 1 / XDPE132G5C: Secondary I2C Interface",
                        "In schematic: bus 11 (1-based), address 0x82 (8-bit)" ],
          "id": "vdd_p1_dcm1_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/vdd-vrm-connector1/vdd-vrm",
          "i2c_interface": { "bus": 10, "address": "0x41" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_xdpe132g5c_rule"
          }
        },


        {
          "comments": [ "VDN & VCSp0 DCM 0 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 10 (1-based), address 0xE4 (8-bit)" ],
          "id": "vdn_vcs_p0_dcm0_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x72" },
          "rails": [
            {
              "comments": [ "PMBus PAGE 0 rail" ],
              "id": "vdn_dcm0_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page0_rule"
              }
            },
            {
              "comments": [ "PMBus PAGE 1 rail" ],
              "id": "vcs_p0_dcm0_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page1_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDN & VCSp0 DCM 0 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 10 (1-based), address 0x84 (8-bit)" ],
          "id": "vdn_vcs_p0_dcm0_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x42" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_ir35221_rule"
          }
        },


        {
          "comments": [ "VIO & VCSp1 DCM 0 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 10 (1-based), address 0xE6 (8-bit)" ],
          "id": "vio_vcs_p1_dcm0_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x73" },
          "rails": [
            {
              "comments": [ "PMBus PAGE 0 rail" ],
              "id": "vio_dcm0_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "set_operation_and_voltage_page0_rule"
              }
            },
            {
              "comments": [ "PMBus PAGE 1 rail" ],
              "id": "vcs_p1_dcm0_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page1_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VIO & VCSp1 DCM 0 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 10 (1-based), address 0x86 (8-bit)" ],
          "id": "vio_vcs_p1_dcm0_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x43" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_ir35221_rule"
          }
        },


        {
          "comments": [ "VDN & VCSp0 DCM 1 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 11 (1-based), address 0xE4 (8-bit)" ],
          "id": "vdn_vcs_p0_dcm1_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x72" },
          "rails": [
            {
              "comments": [ "PMBus PAGE 0 rail" ],
              "id": "vdn_dcm1_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page0_rule"
              }
            },
            {
              "comments": [ "PMBus PAGE 1 rail" ],
              "id": "vcs_p0_dcm1_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page1_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VDN & VCSp0 DCM 1 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 11 (1-based), address 0x84 (8-bit)" ],
          "id": "vdn_vcs_p0_dcm1_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x42" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_ir35221_rule"
          }
        },


        {
          "comments": [ "VIO & VCSp1 DCM 1 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 11 (1-based), address 0xE6 (8-bit)" ],
          "id": "vio_vcs_p1_dcm1_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x73" },
          "rails": [
            {
              "comments": [ "PMBus PAGE 0 rail" ],
              "id": "vio_dcm1_rail",
              "configuration": {
                "volts": 0.9,
                "rule_id": "set_operation_and_voltage_page0_rule"
              }
            },
            {
              "comments": [ "PMBus PAGE 1 rail" ],
              "id": "vcs_p1_dcm1_rail",
              "configuration": {
                "volts": 1.0,
                "rule_id": "set_operation_and_voltage_page1_rule"
              }
            }
          ]
        },

        {
          "comments": [ "VIO & VCSp1 DCM 1 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 11 (1-based), address 0x86 (8-bit)" ],
          "id": "vio_vcs_p1_dcm1_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x43" },
          "configuration": {
            "rule_id": "set_avsbus_timeout_ir35221_rule"
          }
        },


        {
          "comments": [ "VPCIe DCM 0 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 10 (1-based), address 0xE8 (8-bit)" ],
          "id": "vpcie_dcm0_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x74" },
          "rails": [
            {
              "id": "vpcie_dcm0_rail"
            }
          ]
        },

        {
          "comments": [ "VPCIe DCM 0 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 10 (1-based), address 0x88 (8-bit)" ],
          "id": "vpcie_dcm0_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 9, "address": "0x44" }
        },


        {
          "comments": [ "VPCIe DCM 1 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 11 (1-based), address 0xE8 (8-bit)" ],
          "id": "vpcie_dcm1_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x74" },
          "rails": [
            {
              "id": "vpcie_dcm1_rail"
            }
          ]
        },

        {
          "comments": [ "VPCIe DCM 1 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 11 (1-based), address 0x88 (8-bit)" ],
          "id": "vpcie_dcm1_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard",
          "i2c_interface": { "bus": 10, "address": "0x44" }
        },


        {
          "comments": [ "Flett Slot C8 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 7 (1-based), address 0xEC (8-bit)" ],
          "id": "flett_slot_c8_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x89/pcie-cable-card",
          "i2c_interface": { "bus": 6, "address": "0x76" },
          "rails": [
            {
              "id": "flett_slot_c8_rail"
            }
          ]
        },

        {
          "comments": [ "Flett Slot C8 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 7 (1-based), address 0x8C (8-bit)" ],
          "id": "flett_slot_c8_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x89/pcie-cable-card",
          "i2c_interface": { "bus": 6, "address": "0x46" }
        },


        {
          "comments": [ "Flett Slot C9 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 7 (1-based), address 0xFA (8-bit)" ],
          "id": "flett_slot_c9_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x86/pcie-cable-card",
          "i2c_interface": { "bus": 6, "address": "0x7D" },
          "rails": [
            {
              "id": "flett_slot_c9_rail"
            }
          ]
        },

        {
          "comments": [ "Flett Slot C9 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 7 (1-based), address 0x9A (8-bit)" ],
          "id": "flett_slot_c9_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x86/pcie-cable-card",
          "i2c_interface": { "bus": 6, "address": "0x4D" }
        },


        {
          "comments": [ "Flett Slot C11 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 12 (1-based), address 0xEC (8-bit)" ],
          "id": "flett_slot_c11_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x87/pcie-cable-card",
          "i2c_interface": { "bus": 11, "address": "0x76" },
          "rails": [
            {
              "id": "flett_slot_c11_rail"
            }
          ]
        },

        {
          "comments": [ "Flett Slot C11 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 12 (1-based), address 0x8C (8-bit)" ],
          "id": "flett_slot_c11_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x87/pcie-cable-card",
          "i2c_interface": { "bus": 11, "address": "0x46" }
        },


        {
          "comments": [ "Flett Slot C10 / IR35221: Primary PMBus Interface",
                        "In schematic: bus 12 (1-based), address 0xFA (8-bit)" ],
          "id": "flett_slot_c10_regulator",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x163/pcie-cable-card",
          "i2c_interface": { "bus": 11, "address": "0x7D" },
          "rails": [
            {
              "id": "flett_slot_c10_rail"
            }
          ]
        },

        {
          "comments": [ "Flett Slot C10 / IR35221: Secondary I2C Interface",
                        "In schematic: bus 12 (1-based), address 0x9A (8-bit)" ],
          "id": "flett_slot_c10_regulator_i2c",
          "is_regulator": true,
          "fru": "/system/chassis/motherboard/pcieslot-x163/pcie-cable-card",
          "i2c_interface": { "bus": 11, "address": "0x4D" }
        }
      ]
    }
  ]
}
